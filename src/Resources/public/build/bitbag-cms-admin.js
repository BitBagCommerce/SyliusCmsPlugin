(()=>{"use strict";function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var r=function(){function r(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{textField:"data-bb-cms-text",fileField:"data-bb-cms-file"};t(this,r),this.config=e,this.textField=document.querySelector("[".concat(e.textField,"]")),this.fileField=document.querySelector("[".concat(e.fileField,"]"))}var a,o,i;return a=r,(o=[{key:"init",value:function(){if("object"!==e(this.config))throw new Error("Bitbag CMS Plugin - HandleCsvUpload class config is not a valid object");this._handleFields()}},{key:"_handleFields",value:function(){this._handleTextField(),this._handleFileField()}},{key:"_handleTextField",value:function(){var e=this;this.textField.addEventListener("click",(function(){e.fileField.click()}))}},{key:"_handleFileField",value:function(){var e=this;this.fileField.addEventListener("change",(function(t){e.textField.value=t.target.files[0].name}))}}])&&n(a.prototype,o),i&&n(a,i),r}();const a=function(e,t,n){var r=new CustomEvent("".concat("bb",".").concat(t),{detail:n});return e.dispatchEvent(r),e};function o(e,t,n,r,a,o,i){try{var c=e[o](i),l=c.value}catch(e){return void n(e)}c.done?t(l):Promise.resolve(l).then(r,a)}function i(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var i=e.apply(t,n);function c(e){o(i,r,a,c,l,"next",e)}function l(e){o(i,r,a,c,l,"throw",e)}c(void 0)}))}}function c(e){return c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},c(e)}function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var u=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{wrappersIndicator:"data-bb-cms-wrapper",lockFieldIndicator:"data-bb-cms-toggle-slug",bbTarget:"bitbag_sylius_cms_plugin_page"};l(this,e),this.wrappers=document.querySelectorAll("[".concat(t.wrappersIndicator,"]")),this.lockFieldIndicator="[".concat(t.lockFieldIndicator,"]"),this.bbTarget=t.bbTarget,this.config=t}var t,n,r,o,u;return t=e,n=[{key:"init",value:function(){if("object"!==c(this.config))throw new Error("Bitbag CMS Plugin - HandleSlugUpdate class config is not a valid object");if("string"!=typeof this.lockFieldIndicator||"string"!=typeof this.bbTarget)throw new Error("Bitbag CMS Plugin - HandleSlugUpdate class config key values are not valid strings");this._handleFields()}},{key:"_handleFields",value:function(){var e=this;this.wrappers.forEach((function(t){var n,r=t.dataset.locale,a=t.querySelector("#".concat(e.bbTarget,"_translations_").concat(r,"_name")),o=t.querySelector("#".concat(e.bbTarget,"_translations_").concat(r,"_slug")),i=t.querySelector(e.lockFieldIndicator);a&&o&&r&&(a.addEventListener("input",(function(t){t.preventDefault(),o.readOnly||(clearTimeout(n),n=setTimeout((function(){e._updateSlug(o,a.value)}),1e3))})),i&&i.addEventListener("click",(function(t){t.preventDefault(),e._toggleSlugModification(o,i)})))}))}},{key:"_updateSlug",value:(u=i(regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a(t,"cms.slug.update.start"),t.parentNode.classList.add("loading"),e.next=4,this._getValidSlug(t.dataset.url,n);case 4:t.value=e.sent,t.parentNode.classList.remove("loading"),a(t,"cms.slug.update.end");case 7:case"end":return e.stop()}}),e,this)}))),function(e,t){return u.apply(this,arguments)})},{key:"_getValidSlug",value:(o=i(regeneratorRuntime.mark((function e(t,n){var r,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch("".concat(t,"?name=").concat(n));case 3:return r=e.sent,e.next=6,r.json();case 6:return a=e.sent,e.abrupt("return",a.slug);case 10:e.prev=10,e.t0=e.catch(0),console.error("BitBag CMS Plugin - HandleSlugUpdate class error : ".concat(e.t0));case 13:case"end":return e.stop()}}),e,null,[[0,10]])}))),function(e,t){return o.apply(this,arguments)})},{key:"_toggleSlugModification",value:function(e,t){e.readOnly=!e.readOnly;var n=t.querySelector("i");n.classList.toggle("lock"),n.classList.toggle("unlock")}}],n&&s(t.prototype,n),r&&s(t,r),e}();function d(e,t,n,r,a,o,i){try{var c=e[o](i),l=c.value}catch(e){return void n(e)}c.done?t(l):Promise.resolve(l).then(r,a)}function f(e){return function(e){if(Array.isArray(e))return m(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return m(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return m(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function m(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function h(e){return h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},h(e)}function p(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function v(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var y=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{previewButton:"data-bb-cms-preview-btn",previewModal:"data-bb-cms-preview-modal",channelSwitch:"data-bb-cms-channel",localeSwitch:"data-bb-cms-locale"};p(this,e),this.config=t,this.button=document.querySelector("[".concat(t.previewButton,"]")),this.modal=document.querySelector("[".concat(t.previewModal,"]")),this.modalSelector=t.previewModal,this.channelSelector=t.channelSwitch,this.localeSelector=t.localeSwitch}var t,n,r,o,i;return t=e,n=[{key:"init",value:function(){if("object"!==h(this.config))throw new Error("Bitbag CMS Plugin - HandlePreview class config is not a valid object");if("string"!=typeof this.localeSelector||"string"!=typeof this.channelSelector||"string"!=typeof this.modalSelector)throw new Error("Bitbag CMS Plugin - HandlePreview class config key values are not valid strings");this._resourcePreview()}},{key:"_$_CKEDITOR_MODAL_SHOW",value:function(){return $("[".concat(this.modalSelector,"]")).modal("show")}},{key:"_$_CKEDITOR_UPDATE_INSTANCES",value:function(){f(CKEDITOR.instances).forEach((function(e){return e.updateElement()}))}},{key:"_resourcePreview",value:function(){var e=this;this.button.addEventListener("click",(function(t){t.preventDefault(),e._$_CKEDITOR_UPDATE_INSTANCES,e._createPreview(),e._$_CKEDITOR_MODAL_SHOW()})),document.querySelector("[".concat(this.channelSelector,"]")).addEventListener("change",(function(t){t.preventDefault(),e._$_CKEDITOR_UPDATE_INSTANCES,e._createPreview(),e._$_CKEDITOR_MODAL_SHOW()})),document.querySelector("[".concat(this.localeSelector,"]")).addEventListener("change",(function(t){t.preventDefault(),e._$_CKEDITOR_UPDATE_INSTANCES,e._createPreview(),e._$_CKEDITOR_MODAL_SHOW()}))}},{key:"_createPreview",value:(o=regeneratorRuntime.mark((function e(){var t,n,r,o,i,c,l,s,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.modal.querySelector(".ui.loadable").classList.add("loading"),this.modal.disabled=!0,t=document.querySelector("[".concat(this.channelSelector,"]")).value,n=document.querySelector("[".concat(this.localeSelector,"]")).value,r=this.button.dataset.url,o=this.button.closest("form"),i={method:"POST",body:new FormData(o)},e.prev=7,a(this.modal,"cms.create.preview.start"),e.next=11,fetch("".concat(r,"?_channel_code=").concat(t,"&_locale=").concat(n),i);case 11:return c=e.sent,e.next=14,c.text();case 14:l=e.sent,s=new Blob([l],{type:"text/html",charset:"utf-8"}),u=window.URL.createObjectURL(s),this.modal.querySelector("iframe").src=u,a(this.modal,"cms.create.preview.completed",l),e.next=25;break;case 21:e.prev=21,e.t0=e.catch(7),console.error("BitBag CMS Plugin - HandlePreview class error : ".concat(e.t0)),a(this.modal,"cms.create.preview.error",e.t0);case 25:return e.prev=25,this.modal.querySelector(".ui.loadable").classList.remove("loading"),this.modal.disabled=!1,a(this.modal,"cms.create.preview.end"),e.finish(25);case 30:case"end":return e.stop()}}),e,this,[[7,21,25,30]])})),i=function(){var e=this,t=arguments;return new Promise((function(n,r){var a=o.apply(e,t);function i(e){d(a,n,r,i,c,"next",e)}function c(e){d(a,n,r,i,c,"throw",e)}i(void 0)}))},function(){return i.apply(this,arguments)})}],n&&v(t.prototype,n),r&&v(t,r),e}();function b(e,t,n,r,a,o,i){try{var c=e[o](i),l=c.value}catch(e){return void n(e)}c.done?t(l):Promise.resolve(l).then(r,a)}function g(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var o=e.apply(t,n);function i(e){b(o,r,a,i,c,"next",e)}function c(e){b(o,r,a,i,c,"throw",e)}i(void 0)}))}}function S(e){return S="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},S(e)}function w(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var k=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{bbMediaContainer:"data-bb-cms-autocomplete",choiceName:"data-bb-cms-choice-name",choiceValue:"data-bb-cms-choice-value",criteriaType:"data-bb-cms-criteria-type",criteriaName:"data-bb-cms-criteria-name",editUrl:"data-bb-cms-load-edit-url",nameMessage:"data-bb-cms-name-message",deleteButton:"data-bb-cms-delete-selected",choosenPreview:"data-bb-cms-selected-image",selectMenu:"data-bb-cms-selection-menu",selectInput:"data-bb-cms-image-select",placeholder:"data-bb-cms-placeholder",limit:30};w(this,e),this.config=t,this.mediaContainers=document.querySelectorAll("[".concat(t.bbMediaContainer,"]")),this.deleteButton="[".concat(t.deleteButton,"]"),this.selectMenu="[".concat(t.selectMenu,"]"),this.selectInput="[".concat(t.selectInput,"]"),this.placeholder="[".concat(t.placeholder,"]")}var t,n,r,o,i;return t=e,n=[{key:"init",value:function(){var e=this;if("object"!==S(this.config))throw new Error("Bitbag CMS Plugin - HandleAutoComplete class config is not a valid object");this.mediaContainers.forEach((function(t){e._handleSavedValue(t),e._handleImageChoice(t),e._handleResetBtn(t)}))}},{key:"_handleResetBtn",value:function(e){var t=this,n=e.querySelector(this.deleteButton);""!==e.querySelector("input[type=hidden]").value?(n.classList.remove("is-hidden"),n.addEventListener("click",(function(n){t._resetValues(e)}))):n.classList.add("is-hidden")}},{key:"_handleImageChoice",value:function(e){var t=this;e.querySelector(this.selectInput).addEventListener("click",(function(n){n.preventDefault(),t._getMediaImages(e)})),e.querySelector("input[type=hidden]").addEventListener("change",(function(n){n.preventDefault(),t._handleResetBtn(e)}))}},{key:"_handleSavedValue",value:(i=g(regeneratorRuntime.mark((function e(t){var n,r,o,i,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(""!==t.querySelector("input[type=hidden]").value){e.next=2;break}return e.abrupt("return");case 2:return n="".concat(t.dataset.bbCmsLoadEditUrl,"?code=").concat(t.querySelector("input[type=hidden]").value),e.prev=3,a(t,"cms.media.saved.reload.start"),t.classList.add("loading"),e.next=8,fetch(n);case 8:return i=e.sent,e.next=11,i.json();case 11:c=e.sent,this._addToSelectMenu(c,t),null===(r=t.querySelector(this.selectMenu))||void 0===r||null===(o=r.firstChild)||void 0===o||o.click(),a(t,"cms.media.saved.reload.completed",c),e.next=21;break;case 17:e.prev=17,e.t0=e.catch(3),console.error("BitBag CMS Plugin - HandleAutoComplete class error : ".concat(e.t0)),a(t,"cms.media.saved.reload.error",e.t0);case 21:return e.prev=21,t.classList.remove("loading"),a(t,"cms.media.saved.reload.end"),e.finish(21);case 25:case"end":return e.stop()}}),e,this,[[3,17,21,25]])}))),function(e){return i.apply(this,arguments)})},{key:"_getMediaImages",value:(o=g(regeneratorRuntime.mark((function e(t){var n,r,o,i,c,l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.dataset.bbCmsUrl,r=t.dataset.bbCmsCriteriaType,o="".concat(n,"&limit=").concat(this.config.limit,"&criteria[search][type]=").concat(r),e.prev=3,a(t,"cms.media.display.start"),t.classList.add("loading"),e.next=8,fetch(o);case 8:return i=e.sent,e.next=11,i.json();case 11:c=e.sent,l=c._embedded.items,this._addToSelectMenu(l,t),a(t,"cms.media.display.completed",c),e.next=21;break;case 17:e.prev=17,e.t0=e.catch(3),console.error("BitBag CMS Plugin - HandleAutoComplete class error : ".concat(e.t0)),a(t,"cms.media.display.error",e.t0);case 21:return e.prev=21,t.classList.remove("loading"),a(t,"cms.media.display.end"),e.finish(21);case 25:case"end":return e.stop()}}),e,this,[[3,17,21,25]])}))),function(e){return o.apply(this,arguments)})},{key:"_resetValues",value:function(e){a(e,"cms.media.reset.start"),e.querySelector("input[type=hidden]").value="",e.querySelector(this.selectMenu).innerHTML="",e.querySelector(this.placeholder).innerHTML="",a(e,"cms.media.reset.end")}},{key:"_addToSelectMenu",value:function(e,t){var n=this;a(t,"cms.media.display.update.start");var r=t.querySelector(this.selectMenu);r.innerHTML="",null==e||e.forEach((function(e){r.insertAdjacentHTML("beforeend",n._itemTemplate(e.path,e.code.trim()))})),a(t,"cms.media.display.update.end")}},{key:"_itemTemplate",value:function(e,t){return'<div class="item" data-value="'.concat(t,'"><img src="').concat(e,'"/><strong>').concat(t,"</strong></div>")}}],n&&_(t.prototype,n),r&&_(t,r),e}();var E;document.querySelector('[data-bb-target="cms-import"]')&&(new r).init(),(null===(E=document.querySelectorAll('[data-bb-target="cms-slug-update"]'))||void 0===E?void 0:E.length)>0&&(new u).init(),document.querySelectorAll("[data-bb-cms-preview-btn]").length>0&&(new y).init(),document.querySelector('[data-bb-target="cms-handle-autocomplete"]')&&(new k).init()})();