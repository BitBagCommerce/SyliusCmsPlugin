(()=>{"use strict";function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var a=function(){function a(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{textField:"data-bb-cms-text",fileField:"data-bb-cms-file"};t(this,a),this.config=e,this.textField=document.querySelector("[".concat(e.textField,"]")),this.fileField=document.querySelector("[".concat(e.fileField,"]"))}var r,i,o;return r=a,(i=[{key:"init",value:function(){if("object"!==e(this.config))throw new Error("Bitbag CMS Plugin - HandleCsvUpload class config is not a valid object");this._handleFields()}},{key:"_handleFields",value:function(){this._handleTextField(),this._handleFileField()}},{key:"_handleTextField",value:function(){var e=this;this.textField.addEventListener("click",(function(){e.fileField.click()}))}},{key:"_handleFileField",value:function(){var e=this;this.fileField.addEventListener("change",(function(t){e.textField.value=t.target.files[0].name}))}}])&&n(r.prototype,i),o&&n(r,o),a}();const r=function(e,t,n){var a=new CustomEvent("".concat("bb",".").concat(t),{detail:n});return e.dispatchEvent(a),e};function i(e,t,n,a,r,i,o){try{var c=e[i](o),l=c.value}catch(e){return void n(e)}c.done?t(l):Promise.resolve(l).then(a,r)}function o(e){return function(){var t=this,n=arguments;return new Promise((function(a,r){var o=e.apply(t,n);function c(e){i(o,a,r,c,l,"next",e)}function l(e){i(o,a,r,c,l,"throw",e)}c(void 0)}))}}function c(e){return c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},c(e)}function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var u=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{wrappersIndicator:"data-bb-cms-wrapper",lockFieldIndicator:"data-bb-cms-toggle-slug",bbTarget:"bitbag_sylius_cms_plugin_page"};l(this,e),this.wrappers=document.querySelectorAll("[".concat(t.wrappersIndicator,"]")),this.lockFieldIndicator="[".concat(t.lockFieldIndicator,"]"),this.bbTarget=t.bbTarget,this.config=t}var t,n,a,i,u;return t=e,n=[{key:"init",value:function(){if("object"!==c(this.config))throw new Error("Bitbag CMS Plugin - HandleSlugUpdate class config is not a valid object");if("string"!=typeof this.lockFieldIndicator||"string"!=typeof this.bbTarget)throw new Error("Bitbag CMS Plugin - HandleSlugUpdate class config key values are not valid strings");this._handleFields()}},{key:"_handleFields",value:function(){var e=this;this.wrappers.forEach((function(t){var n,a=t.dataset.locale,r=t.querySelector("#".concat(e.bbTarget,"_translations_").concat(a,"_name")),i=t.querySelector("#".concat(e.bbTarget,"_translations_").concat(a,"_slug")),o=t.querySelector(e.lockFieldIndicator);r&&i&&a&&(r.addEventListener("input",(function(t){t.preventDefault(),i.readOnly||(clearTimeout(n),n=setTimeout((function(){e._updateSlug(i,r.value)}),1e3))})),o&&o.addEventListener("click",(function(t){t.preventDefault(),e._toggleSlugModification(i,o)})))}))}},{key:"_updateSlug",value:(u=o(regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r(t,"cms.slug.update.start"),t.parentNode.classList.add("loading"),e.next=4,this._getValidSlug(t.dataset.url,n);case 4:t.value=e.sent,t.parentNode.classList.remove("loading"),r(t,"cms.slug.update.end");case 7:case"end":return e.stop()}}),e,this)}))),function(e,t){return u.apply(this,arguments)})},{key:"_getValidSlug",value:(i=o(regeneratorRuntime.mark((function e(t,n){var a,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch("".concat(t,"?name=").concat(n));case 3:return a=e.sent,e.next=6,a.json();case 6:return r=e.sent,e.abrupt("return",r.slug);case 10:e.prev=10,e.t0=e.catch(0),console.error("BitBag CMS Plugin - HandleSlugUpdate class error : ".concat(e.t0));case 13:case"end":return e.stop()}}),e,null,[[0,10]])}))),function(e,t){return i.apply(this,arguments)})},{key:"_toggleSlugModification",value:function(e,t){e.readOnly=!e.readOnly;var n=t.querySelector("i");n.classList.toggle("lock"),n.classList.toggle("unlock")}}],n&&s(t.prototype,n),a&&s(t,a),e}();function d(e,t,n,a,r,i,o){try{var c=e[i](o),l=c.value}catch(e){return void n(e)}c.done?t(l):Promise.resolve(l).then(a,r)}function m(e){return function(e){if(Array.isArray(e))return h(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return h(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return h(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function h(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}function f(e){return f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},f(e)}function p(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function v(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var b=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{previewButton:"data-bb-cms-preview-btn",previewModal:"data-bb-cms-preview-modal",channelSwitch:"data-bb-cms-channel",localeSwitch:"data-bb-cms-locale"};p(this,e),this.config=t,this.button=document.querySelector("[".concat(t.previewButton,"]")),this.modal=document.querySelector("[".concat(t.previewModal,"]")),this.modalSelector=t.previewModal,this.channelSelector=t.channelSwitch,this.localeSelector=t.localeSwitch}var t,n,a,i,o;return t=e,n=[{key:"init",value:function(){if("object"!==f(this.config))throw new Error("Bitbag CMS Plugin - HandlePreview class config is not a valid object");if("string"!=typeof this.localeSelector||"string"!=typeof this.channelSelector||"string"!=typeof this.modalSelector)throw new Error("Bitbag CMS Plugin - HandlePreview class config key values are not valid strings");this._resourcePreview()}},{key:"_$_CKEDITOR_MODAL_SHOW",value:function(){return $("[".concat(this.modalSelector,"]")).modal("show")}},{key:"_$_CKEDITOR_UPDATE_INSTANCES",value:function(){m(CKEDITOR.instances).forEach((function(e){return e.updateElement()}))}},{key:"_resourcePreview",value:function(){var e=this;this.button.addEventListener("click",(function(t){t.preventDefault(),e._$_CKEDITOR_UPDATE_INSTANCES,e._createPreview(),e._$_CKEDITOR_MODAL_SHOW()}))}},{key:"_createPreview",value:(i=regeneratorRuntime.mark((function e(){var t,n,a,i,o,c,l,s,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.modal.querySelector(".ui.loadable").classList.add("loading"),this.modal.disabled=!0,t=document.querySelector("[".concat(this.channelSelector,"]")).value,n=document.querySelector("[".concat(this.localeSelector,"]")).value,a=this.button.dataset.url,i=this.button.closest("form"),o={method:"POST",body:new FormData(i)},e.prev=7,r(this.modal,"cms.create.preview.start"),e.next=11,fetch("".concat(a,"?_channel_code=").concat(t,"&_locale=").concat(n),o);case 11:return c=e.sent,e.next=14,c.text();case 14:l=e.sent,s=new Blob([l],{type:"text/html",charset:"utf-8"}),u=window.URL.createObjectURL(s),this.modal.querySelector("iframe").src=u,r(this.modal,"cms.create.preview.completed",l),e.next=25;break;case 21:e.prev=21,e.t0=e.catch(7),console.error("BitBag CMS Plugin - HandlePreview class error : ".concat(e.t0)),r(this.modal,"cms.create.preview.error",e.t0);case 25:return e.prev=25,this.modal.querySelector(".ui.loadable").classList.remove("loading"),this.modal.disabled=!1,r(this.modal,"cms.create.preview.end"),e.finish(25);case 30:case"end":return e.stop()}}),e,this,[[7,21,25,30]])})),o=function(){var e=this,t=arguments;return new Promise((function(n,a){var r=i.apply(e,t);function o(e){d(r,n,a,o,c,"next",e)}function c(e){d(r,n,a,o,c,"throw",e)}o(void 0)}))},function(){return o.apply(this,arguments)})}],n&&v(t.prototype,n),a&&v(t,a),e}();function y(e,t,n,a,r,i,o){try{var c=e[i](o),l=c.value}catch(e){return void n(e)}c.done?t(l):Promise.resolve(l).then(a,r)}function g(e){return function(){var t=this,n=arguments;return new Promise((function(a,r){var i=e.apply(t,n);function o(e){y(i,a,r,o,c,"next",e)}function c(e){y(i,a,r,o,c,"throw",e)}o(void 0)}))}}function S(e){return S="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},S(e)}function w(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var C=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{bbMediaContainer:"data-bb-cms-autocomplete",choiceName:"data-bb-cms-choice-name",choiceValue:"data-bb-cms-choice-value",criteriaType:"data-bb-cms-criteria-type",criteriaName:"data-bb-cms-criteria-name",editUrl:"data-bb-cms-load-edit-url",nameMessage:"data-bb-cms-name-message",deleteButton:"data-bb-cms-delete-selected",choosenPreview:"data-bb-cms-selected-image",selectMenu:"data-bb-cms-selection-menu",selectInput:"data-bb-cms-image-select",placeholder:"data-bb-cms-placeholder",limit:30};w(this,e),this.config=t,this.mediaContainer=document.querySelector("[".concat(t.bbMediaContainer,"]")),this.deleteButton=document.querySelector("[".concat(t.deleteButton,"]")),this.selectMenu=document.querySelector("[".concat(t.selectMenu,"]")),this.selectInput=document.querySelector("[".concat(t.selectInput,"]")),this.placeholder=document.querySelector("[".concat(t.placeholder,"]")),this.hiddenInput=this.mediaContainer.querySelector("input[type=hidden]")}var t,n,a,i,o;return t=e,n=[{key:"init",value:function(){if("object"!==S(this.config))throw new Error("Bitbag CMS Plugin - HandleAutoComplete class config is not a valid object");this._handleSavedValue(),this._handleImageChoice(),this._handleResetBtn()}},{key:"_handleResetBtn",value:function(){var e=this;""!==this.hiddenInput.value?(this.deleteButton.classList.remove("is-hidden"),this.deleteButton.addEventListener("click",(function(t){e._resetValues()}))):this.deleteButton.classList.add("is-hidden")}},{key:"_handleImageChoice",value:function(){var e=this;this.selectInput.addEventListener("click",(function(t){t.preventDefault(),e._getMediaImages()})),this.hiddenInput.addEventListener("change",(function(t){t.preventDefault(),e._handleResetBtn()}))}},{key:"_handleSavedValue",value:(o=g(regeneratorRuntime.mark((function e(){var t,n,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(""!==this.hiddenInput.value){e.next=2;break}return e.abrupt("return");case 2:return t="".concat(this.mediaContainer.dataset.bbCmsLoadEditUrl,"?code=").concat(this.hiddenInput.value),e.prev=3,r(this.mediaContainer,"cms.media.saved.reload.start"),this.mediaContainer.classList.add("loading"),e.next=8,fetch(t);case 8:return n=e.sent,e.next=11,n.json();case 11:a=e.sent,this._addToSelectMenu(a),this.selectMenu.firstChild.click(),r(this.mediaContainer,"cms.media.saved.reload.completed",a),e.next=21;break;case 17:e.prev=17,e.t0=e.catch(3),console.error("BitBag CMS Plugin - HandleAutoComplete class error : ".concat(e.t0)),r(this.mediaContainer,"cms.media.saved.reload.error",e.t0);case 21:return e.prev=21,this.mediaContainer.classList.remove("loading"),r(this.mediaContainer,"cms.media.saved.reload.end"),e.finish(21);case 25:case"end":return e.stop()}}),e,this,[[3,17,21,25]])}))),function(){return o.apply(this,arguments)})},{key:"_getMediaImages",value:(i=g(regeneratorRuntime.mark((function e(){var t,n,a,i,o,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.mediaContainer.dataset.bbCmsUrl,n=this.mediaContainer.dataset.bbCmsCriteriaType,a="".concat(t,"&limit=").concat(this.config.limit,"&criteria[search][type]=").concat(n),e.prev=3,r(this.mediaContainer,"cms.media.display.start"),this.mediaContainer.classList.add("loading"),e.next=8,fetch(a);case 8:return i=e.sent,e.next=11,i.json();case 11:o=e.sent,c=o._embedded.items,this._addToSelectMenu(c),r(this.mediaContainer,"cms.media.display.completed",o),e.next=21;break;case 17:e.prev=17,e.t0=e.catch(3),console.error("BitBag CMS Plugin - HandleAutoComplete class error : ".concat(e.t0)),r(this.mediaContainer,"cms.media.display.error",e.t0);case 21:return e.prev=21,this.mediaContainer.classList.remove("loading"),r(this.mediaContainer,"cms.media.display.end"),e.finish(21);case 25:case"end":return e.stop()}}),e,this,[[3,17,21,25]])}))),function(){return i.apply(this,arguments)})},{key:"_resetValues",value:function(){r(this.mediaContainer,"cms.media.reset.start"),this.hiddenInput.value="",this.selectMenu.innerHTML="",this.placeholder.innerHTML="",r(this.mediaContainer,"cms.media.reset.end")}},{key:"_addToSelectMenu",value:function(e){var t=this;r(this.mediaContainer,"cms.media.display.update.start"),this.selectMenu.innerHTML="",e.forEach((function(e){t.selectMenu.insertAdjacentHTML("beforeend",t._itemTemplate(e.path,e.code.trim()))})),r(this.mediaContainer,"cms.media.display.update.end")}},{key:"_itemTemplate",value:function(e,t){return'<div class="item" data-value="'.concat(t,'"><img src="').concat(e,'"/><strong>').concat(t,"</strong></div>")}}],n&&_(t.prototype,n),a&&_(t,a),e}();var k;document.querySelector('[data-bb-target="cms-import"]')&&(new a).init(),(null===(k=document.querySelectorAll('[data-bb-target="cms-slug-update"]'))||void 0===k?void 0:k.length)>0&&(new u).init(),document.querySelectorAll("[data-bb-cms-preview-btn]").length>0&&(new b).init(),document.querySelector('[data-bb-target="cms-handle-autocomplete"]')&&(new C).init()})();